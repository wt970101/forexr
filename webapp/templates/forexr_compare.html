{% extends 'base.html' %}
{% set page_title = '外匯比較' %}

{% block content %}
<section>
    <!-- 幣別選擇 + 搜尋按鈕 -->
    <div class="row mb-3">
        <div class="col-lg-3">
            <select class="form-control form-control-lg" id="selCurrency">
                <option value="USD">美金</option>
                <option value="CNY">人民幣</option>
                <option value="JPY">日圓</option>
                <option value="EUR">歐元</option>
                <option value="HKD">港幣</option>
                <option value="AUD">澳幣</option>
                <option value="ZAR">南非幣</option>
                <option value="CAD">加拿大幣</option>
                <option value="GBP">英鎊</option>
                <option value="SGD">新加坡幣</option>
                <option value="CHF">瑞士法郎</option>
                <option value="NZD">紐元</option>
                <option value="SEK">瑞典克朗</option>
                <option value="THB">泰銖</option>
                <option value="PHP">菲律賓披索</option>
                <option value="IDR">印尼盾</option>
                <option value="KRW">南韓圓</option>
                <option value="VND">越南盾</option>
                <option value="MYR">馬來西亞幣</option>
                <option value="MOP">澳門幣</option>
                <option value="CNH">人民幣（離岸）</option>
                <option value="MXN">墨西哥披索</option>
                <option value="DKK">丹麥克朗</option>
                <option value="TRY">土耳其里拉</option>

            </select>
        </div>
        <div class="col-lg-2">
            <button class="btn btn-lg btn-primary" id="btnSearch">
                搜尋
                <span class="spinner-border spinner-border-sm d-none"></span>
            </button>
        </div>
    </div>

    <!-- 顯示查詢結果 -->
    <div id="rateResult"></div>
</section>
{% endblock %}

{% block extra_js %}
<script>
$('#btnSearch').on('click', function() {
    var currency = $('#selCurrency').val();
    if (!currency) return;

    $('#rateResult').html('');
    $('#btnSearch > span').removeClass('d-none');

    $.ajax({
        type: 'GET',
        url: '/get_currency_rates', // 後端新的 route
        data: { currency: currency }
    })
    .done(function(data) {
        var items = [];
        items.push('<h4 class="text-primary">' + currency + '</h4>');
        items.push('<table class="table table-striped table-rates">');
        items.push('<thead class="table-dark"><tr><th>銀行</th><th>即期買進</th><th>即期賣出</th><th>現金買進</th><th>現金賣出</th></tr></thead>');
        items.push('<tbody>');

        $.each(data.rates, function(_, row) {
            items.push('<tr><td>' + row['銀行'] + '</td><td>' + row['即期買進'] + '</td><td>' + row['即期賣出'] + '</td><td>' + row['現金買進'] + '</td><td>' + row['現金賣出'] + '</td></tr>');
        });

        items.push('</tbody></table>');
        $('#rateResult').html(items.join(''));
    })
    .fail(function(jqXHR) {
        alert('查詢失敗: ' + jqXHR.status);
    })
    .always(function() {
        $('#btnSearch > span').addClass('d-none');
    });
});
</script>
{% endblock %}
