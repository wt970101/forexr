{% extends 'base.html' %}
{% set page_title = '外匯試算' %}

{% block content %}
<section class="container mt-5">
  <h2 class="text-center mb-4">{{ page_title }}</h2>

  <div class="card p-4 shadow-sm border border-secondary" style="max-width: 600px; margin: auto; border-radius: 15px;">
    <!-- 兌換金額 -->
    <div class="mb-3">
      <label class="form-label fw-bold">兌換金額</label>
      <input type="number" id="amount" class="form-control" placeholder="請輸入金額">
    </div>

    <!-- 兌換外幣 -->
    <div class="mb-3">
      <label class="form-label fw-bold">兌換外幣</label>
      <select id="currency" class="form-control">
        <option value="">請選擇幣別</option>
        <option value="USD">美金</option>
        <option value="CNY">人民幣</option>
        <option value="JPY">日圓</option>
        <option value="EUR">歐元</option>
        <option value="HKD">港幣</option>
        <option value="AUD">澳幣</option>
        <option value="ZAR">南非幣</option>
        <option value="CAD">加拿大幣</option>
        <option value="GBP">英鎊</option>
        <option value="SGD">新加坡幣</option>
        <option value="CHF">瑞士法郎</option>
        <option value="NZD">紐元</option>
        <option value="SEK">瑞典克朗</option>
        <option value="THB">泰銖</option>
        <option value="PHP">菲律賓披索</option>
        <option value="IDR">印尼盾</option>
        <option value="KRW">南韓圓</option>
        <option value="VND">越南盾</option>
        <option value="MYR">馬來西亞幣</option>
        <option value="MOP">澳門幣</option>
        <option value="CNH">人民幣（離岸）</option>
        <option value="MXN">墨西哥披索</option>
        <option value="DKK">丹麥克朗</option>
        <option value="TRY">土耳其里拉</option>
      </select>
    </div>

    <!-- 兌換銀行 -->
    <div class="mb-3">
      <label class="form-label fw-bold">兌換銀行</label>
      <select id="bank" class="form-control">
        <option value="">請選擇銀行</option>
              <option value="台灣銀行">臺灣銀行</option>
              <option value="台北富邦">台北富邦</option>
              <option value="國泰世華">國泰世華</option>
              <option value="玉山銀行">玉山銀行</option>
              <option value="元大銀行">元大銀行</option>
              <option value="永豐銀行">永豐銀行</option>
              <option value="台新銀行">台新銀行</option>
      </select>
    </div>

    <!-- 轉換方向 -->
    <div class="mb-3">
      <label class="form-label fw-bold">轉換方向</label>
      <select id="direction" class="form-control">
        <option value="toTWD">外幣 ➜ 台幣</option>
        <option value="toForeign">台幣 ➜ 外幣</option>
      </select>
    </div>

    <!-- 試算按鈕 -->
    <div class="text-center mt-4">
      <button id="btnCalculate" class="btn btn-dark px-4">試算</button>
    </div>

    <!-- 結果顯示 -->
    <div class="mt-4 text-center">
      <h5 class="fw-bold">得到金額：</h5>
      <p id="result" class="fs-4 text-success">--</p>
    </div>
  </div>

  <!-- 備註區 -->
  <div class="text-muted small mt-4" style="max-width: 600px; margin: auto;">
    <p>備註：</p>
    <p>1、「原始幣別」為您欲兌換之貨幣幣別，「轉換幣別」為兌換後得到之貨幣幣別。</p>
    <p>2、試算結果僅供參考，實際之換算金額仍以交易當時匯率為準。</p>
  </div>
</section>

<script>
document.getElementById("btnCalculate").addEventListener("click", async () => {
  const amount = document.getElementById("amount").value;
  const currency = document.getElementById("currency").value;
  const bank = document.getElementById("bank").value;
  const direction = document.getElementById("direction").value;
  const resultDiv = document.getElementById("result");

  if (!amount || !currency || !bank || !direction) {
    resultDiv.innerText = "請完整填寫所有欄位";
    resultDiv.classList.remove("text-success");
    resultDiv.classList.add("text-danger");
    return;
  }

  try {
    const response = await fetch("/calculate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ amount, currency, bank, direction })
    });

    const data = await response.json();
    if (data.result) {
      resultDiv.innerText = data.result + " 元";
      resultDiv.classList.add("text-success");
      resultDiv.classList.remove("text-danger");
    } else {
      resultDiv.innerText = "此銀行沒有該外幣外匯項目";
      resultDiv.classList.remove("text-success");
      resultDiv.classList.add("text-danger");
    }
  } catch (error) {
    resultDiv.innerText = "伺服器錯誤";
    resultDiv.classList.remove("text-success");
    resultDiv.classList.add("text-danger");
  }
});
</script>
{% endblock %}
